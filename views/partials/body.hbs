<script type="text/javascript">
  var url = '/';
  var randCallback = 'body' + String(Math.round(Math.random() * 100000));
  var mainDiv = document.body

  var deserializeState = function (serializedJavascript) {
    return eval('(' + serializedJavascript + ')')
  }

  var extendState = function (obj1, obj2) {
    if (!obj2) {
      return obj1;
    }
    for (var key in obj2) {
      if (Object.prototype.hasOwnProperty.call(obj2, key)) {
        obj1[key] = obj1[key] || obj2[key];
      }
    }
    return obj1;
  };

  window[randCallback] = function (bodyContent) {
    try {
      __INITIAL_STATE__ = extendState(deserializeState(__INITIAL_STATE__), JSON.parse(bodyContent.state), {
        User: {
          user: extendState(__USER_STATE__, {
            authorized: true,
            picture: '/images/default/carre.jpg'
          })
        }
      });
      mainDiv.innerHTML = bodyContent.html;
      mainDiv.classList.remove('hidden')
    } catch
      (err) {
      console.log('Geo callback jsonp error')
      mainDiv.classList.remove('hidden')
    }
  }

  if (__GEO_STATE__) {
    document.write('<scr' + 'ipt type="text/javascript" src="' + url + '?format=json&location=' + window.location.pathname + '&callback=' + randCallback + (__GEO_STATE__ && __GEO_STATE__.countryCode && '&country=' + __GEO_STATE__.countryCode || '') + (__USER_STATE__ && __USER_STATE__.planCode && '&subscribed=' + __USER_STATE__.planCode || '') + '"></scr' + 'ipt>');
  } else {
    __GEO_STATE__ = {
      country: geoData.country
    };
  }
</script>
