<script>
  var url = '/';
  var randCallback = 'body' + String(Math.round(Math.random() * 100000));

  var deserializeState = function (serializedJavascript) {
    return eval('(' + serializedJavascript + ')')
  }

  var extendState = function (origin, add) {
    if (!add || (typeof add !== 'object' && add !== null)) {
      return origin;
    }

    var keys = Object.keys(add);
    var i = keys.length;
    while (i--) {
      origin[keys[i]] = add[keys[i]];
    }
    return origin;
  }

  window[randCallback] = function (bodyContent) {
    try {
      __INITIAL_STATE__ = extendState(deserializeState(__INITIAL_STATE__), JSON.parse(bodyContent.state));
      const mainDiv = document.getElementById('main')
      console.log('body', __INITIAL_STATE__);
      mainDiv.innerHTML = bodyContent.html
    } catch (err) {
      console.log('Geo callback jsonp error')
    }
  }

  if (__GEO_STATE__) {
    document.write('<scr' + 'ipt src="' + url + '?country=' + __GEO_STATE__.country + '&format=json&callback=' + randCallback + '&subscribed=' + __USER_STATE__._id + '"></scr' + 'ipt>');
  } else {
    __GEO_STATE__ = {
      country: geoData.country
    };
  }
</script>
