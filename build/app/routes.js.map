{"version":3,"sources":["../../server/app/routes.js"],"names":[],"mappings":";;;;;kBAUwB,M;;AAVxB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;AAIe,SAAS,MAAT,CAAiB,GAAjB,EAAsB,SAAtB,EAAiC;;AAE9C,MAAM,MAAM,QAAQ,GAAR,CAAY,QAAZ,IAAwB,aAApC;;;AAGA,MAAI,GAAJ,CAAQ,cAAR,EAAwB,UAAC,GAAD,EAAM,GAAN,EAAc;AACpC,QAAI,MAAJ,CAAW,cAAX,EAA2B,iBAA3B;AACA,QAAI,QAAJ,CAAa,eAAK,IAAL,CAAU,UAAV,EAAsB,aAAtB,CAAb;AACD,GAHD;;;;AAOA,MAAI,GAAJ,CAAQ,OAAR;;;;AAIA,MAAI,GAAJ,CAAQ,SAAR;;;;AAIA,MAAI,GAAJ,CAAQ,UAAR;;;;;;;AAOA,MAAM,YAAa,QAAQ,aAAT,GAA0B,aAAG,YAAH,CAAgB,eAAK,IAAL,CAAU,SAAV,EAAqB,UAArB,CAAhB,CAA1B,GAA8E,IAAI,IAAJ,GAAW,OAAX,EAAhG;;AAEA,MAAI,GAAJ,CAAQ,IAAR,EAAc,UAAC,GAAD,EAAM,GAAN,EAAc;AAC1B,QAAI,GAAJ,CAAQ,eAAR,EAAyB,mBAAzB;;AAEA,QAAM,UAAU,CAAC,QAAD,EAAW,MAAX,EAAmB,GAAnB,CAAuB,oBAAY;AACjD,UAAI,QAAQ,aAAZ,EAA2B;AAAA,qDACpB,gBADoB;AAAA,YACD,IADC,yBACD,IADC;AAAA,YACK,IADL,yBACK,IADL;;AAEzB,sBAAY,IAAZ,SAAoB,IAApB,gBAAmC,QAAnC;AACD;AACD,0BAAkB,QAAlB,YAAiC,SAAjC;AACD,KANe,CAAhB;;AAQA,QAAM,WAAW,CAAC,MAAD,EAAS,GAAT,CAAa,oBAAY;AACxC,UAAI,QAAQ,aAAZ,EAA2B;AAAA,sDACpB,gBADoB;AAAA,YACD,IADC,0BACD,IADC;AAAA,YACK,IADL,0BACK,IADL;;AAEzB,sBAAY,IAAZ,SAAoB,IAApB,gBAAmC,QAAnC;AACD;AACD,0BAAkB,QAAlB,aAAkC,SAAlC;AACD,KANgB,CAAjB;;AAQA,QAAM,cAAc,iBAAO,WAA3B;;;AAGA,QAAM,SAAS,cAAf;AACA,QAAM,UAAU;AACd,sBADc;AAEd,8BAFc;AAGd,wBAHc;AAId,oBAAc,EAJA;AAKd,YAAM;AALQ,KAAhB;;AAQA,0BAAO,GAAP,EAAY,GAAZ,EAAiB,MAAjB,EAAyB;AACvB;AADuB,KAAzB;AAGD,GAlCD;AAoCD","file":"routes.js","sourcesContent":["import auth from '../auth'\nimport avatar from './api/avatar'\nimport sharing from './api/sharing'\nimport config from '../../config'\nimport fs from 'fs'\nimport path from 'path'\nimport render from './render'\n// --------------------------------------------------\n// Render layout\n\nexport default function routes (app, buildPath) {\n\n  const env = process.env.NODE_ENV || 'development'\n  // SiteMap\n  // --------------------------------------------------\n  app.get('/sitemap.xml', (req, res) => {\n    res.header('Content-Type', 'application/xml')\n    res.sendFile(path.join(staticPath, 'sitemap.xml'))\n  })\n\n  // OAUTH\n  // --------------------------------------------------\n  app.use('/auth', auth)\n\n  // AVATAR\n  // --------------------------------------------------\n  app.use('/avatar', avatar)\n\n  // SHARING\n  // --------------------------------------------------\n  app.use('/sharing', sharing)\n  // SHARING\n  // --------------------------------------------------\n\n  // RENDER\n  // --------------------------------------------------\n  //Get hashed path webpack\n  const hashValue = (env !== 'development') ? fs.readFileSync(path.join(buildPath, 'hash.txt')) : new Date().getTime()\n\n  app.get('/*', (req, res) => {\n    res.set('Cache-Control', 'public, max-age=0')\n    // Js files\n    const jsPaths = ['vendor', 'main'].map(basename => {\n      if (env === 'development') {\n        let {webpackDevServer: {host, port}} = config\n        return `//${host}:${port}/static/${basename}.js`\n      }\n      return `/static/${basename}.js?${hashValue}`\n    })\n    // Css files\n    const cssPaths = ['main'].map(basename => {\n      if (env === 'development') {\n        let {webpackDevServer: {host, port}} = config\n        return `//${host}:${port}/static/${basename}.css`\n      }\n      return `/static/${basename}.css?${hashValue}`\n    })\n\n    const externalsJs = config.externalsJs\n\n    // Render\n    const layout = 'layouts/main'\n    const payload = {\n      jsPaths,\n      externalsJs,\n      cssPaths,\n      initialState: {},\n      body: ''\n    }\n\n    render(req, res, layout, {\n      payload\n    })\n  })\n\n}\n"]}