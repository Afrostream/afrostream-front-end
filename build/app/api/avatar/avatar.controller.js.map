{"version":3,"sources":["../../../../server/app/api/avatar/avatar.controller.js"],"names":[],"mappings":";;AAAA;;;;;;AAEA,QAAQ,SAAR,GAAoB,UAAU,GAAV,EAAe,GAAf,EAAoB;AACtC,MAAI,KAAJ,CAAU,IAAV;AACA,MAAI,GAAJ,CAAQ,cAAR,EAAwB,YAAxB;;AAEA,MAAI,OAAO,IAAI,MAAJ,CAAW,KAAX,IAAoB,EAA/B;AACA,MAAI,OAAO,EAAX;;AAEA,MAAI,UAAU,CACV,SADU,EACC,SADD,EACY,SADZ,EACuB,SADvB,EACkC,SADlC,EAC6C,SAD7C,EACwD,SADxD,EACmE,SADnE,EAC8E,SAD9E,EACyF,SADzF,EAEV,SAFU,EAEC,SAFD,EAEY,SAFZ,EAEuB,SAFvB,EAEkC,SAFlC,EAE6C,SAF7C,EAEwD,SAFxD,EAEmE,SAFnE,EAE8E,SAF9E,EAEyF,SAFzF,CAAd;MAKE,YAAY,OAAO,IAAP,EAAa,WAAb,GAA2B,KAA3B,CAAiC,GAAjC,CALd;MAME,iBANF;;AASA,MAAI,UAAU,MAAV,IAAoB,CAAxB,EAA2B;AACzB,eAAW,UAAU,CAAV,IAAe,UAAU,CAAV,EAAa,MAAb,CAAoB,CAApB,CAAf,GAAwC,GAAnD;AACD,GAFD,MAEO;AACL,eAAW,UAAU,CAAV,EAAa,MAAb,CAAoB,CAApB,IAAyB,UAAU,CAAV,EAAa,MAAb,CAAoB,CAApB,CAApC;AACD;;AAED,MAAI,YAAY,CAAC,YAAY,GAAZ,GAAkB,EAAlB,GAAuB,SAAS,UAAT,CAAoB,CAApB,CAAxB,IAAkD,EAAlE;AACA,MAAI,cAAc,YAAY,EAA9B;;AAEA,MAAI,SAAS,qBAAW,IAAX,EAAiB,IAAjB,CAAb;AACA,MAAI,MAAM,OAAO,UAAP,CAAkB,IAAlB,CAAV;;AAEA,MAAI,SAAJ,GAAgB,QAAQ,cAAc,CAAtB,CAAhB;AACA,MAAI,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,OAAO,KAA1B,EAAiC,OAAO,MAAxC;AACA,MAAI,IAAJ,GAAW,KAAK,KAAL,CAAW,OAAO,KAAP,GAAe,CAA1B,IAA+B,UAA1C;AACA,MAAI,SAAJ,GAAgB,QAAhB;AACA,MAAI,SAAJ,GAAgB,MAAhB;AACA,MAAI,QAAJ,CAAa,QAAb,EAAuB,OAAO,CAA9B,EAAiC,OAAO,GAAxC;;AAEA,SAAO,UAAP,CAAkB;AAChB,aAAS,I;AADO,MAEd,SAAS,G;AAFK,MAGd,aAAa,K;AAHC,GAAlB,EAIG,IAJH,CAIQ,GAJR;AAKD,CAxCD","file":"avatar.controller.js","sourcesContent":["import Canvas from 'canvas'\n\nexports.getAvatar = function (req, res) {\n  res.cache(3600)\n  res.set('Content-Type', 'image/jpeg')\n\n  let name = req.params.email || ''\n  let size = 50\n\n  let colours = [\n      '#1abc9c', '#2ecc71', '#3498db', '#9b59b6', '#34495e', '#16a085', '#27ae60', '#2980b9', '#8e44ad', '#2c3e50',\n      '#f1c40f', '#e67e22', '#e74c3c', '#ecf0f1', '#95a5a6', '#f39c12', '#d35400', '#c0392b', '#bdc3c7', '#7f8c8d'\n    ],\n\n    nameSplit = String(name).toUpperCase().split('.'),\n    initials\n\n\n  if (nameSplit.length == 1) {\n    initials = nameSplit[0] ? nameSplit[0].charAt(0) : '?'\n  } else {\n    initials = nameSplit[0].charAt(0) + nameSplit[1].charAt(0)\n  }\n\n  let charIndex = (initials == '?' ? 72 : initials.charCodeAt(0)) - 64\n  let colourIndex = charIndex % 20\n\n  let canvas = new Canvas(size, size)\n  let ctx = canvas.getContext('2d')\n\n  ctx.fillStyle = colours[colourIndex - 1]\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\n  ctx.font = Math.round(canvas.width / 2) + 'px Arial'\n  ctx.textAlign = 'center'\n  ctx.fillStyle = '#FFF'\n  ctx.fillText(initials, size / 2, size / 1.5)\n\n  canvas.jpegStream({\n    bufsize: 4096 // output buffer size in bytes, default: 4096\n    , quality: 100 // JPEG quality (0-100) default: 75\n    , progressive: false // true for progressive compression, default: false\n  }).pipe(res)\n}\n"]}