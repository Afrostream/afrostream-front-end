{"version":3,"sources":["../../../server/auth/facebook/facebook.controller.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;uEAwBO,iBAAuB,GAAvB,EAA4B,GAA5B;AAAA,QAGG,oBAHH,EASC,UATD,EAUC,MAVD,EAYG,MAZH;AAAA;AAAA;AAAA;AAAA;AACL,gBAAI,OAAJ;AADK;AAAA;AAAA,mBAGgC,uBAAQ,GAAR,EAAa,uBAAb,EAAsC;AACvE,8BAAgB,KADuD;AAEvE,sBAAQ;AACN,gCAAgB,IAAI,KAAJ,CAAU;AADpB;AAF+D,aAAtC,CAHhC;;AAAA;AAGG,gCAHH;AASC,sBATD,GASc,qBAAqB,CAArB,CATd,EAUC,MAVD,GAUU,qBAAqB,CAArB,CAVV;AAYG,kBAZH,GAYY,6BAZZ;;AAaH,gBAAI,MAAJ,CAAW,WAAW,UAAtB,EAAkC,MAAlC,CAAyC,MAAzC,EAAiD,MAAjD;AAbG;AAAA;;AAAA;AAAA;AAAA;;AAgBH,oBAAQ,KAAR;AACA,gBAAI,MAAJ,CAAW,GAAX,EAAgB,IAAhB,CAAqB,EAArB;;AAjBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;kBAAe,M;;;;;;uEA0Bf,kBAAyB,GAAzB,EAA8B,GAA9B;AAAA,QAGG,oBAHH,EAIC,UAJD,EAKC,MALD,EAOG,MAPH;AAAA;AAAA;AAAA;AAAA;AACL,gBAAI,OAAJ;AADK;AAAA;AAAA,mBAGgC,uBAAQ,GAAR,EAAa,yBAAb,EAAwC,EAAC,gBAAgB,KAAjB,EAAxC,CAHhC;;AAAA;AAGG,gCAHH;AAIC,sBAJD,GAIc,qBAAqB,CAArB,CAJd,EAKC,MALD,GAKU,qBAAqB,CAArB,CALV;AAOG,kBAPH,GAOY,uBAPZ;;AAQH,gBAAI,WAAW,UAAX,KAA0B,GAA9B,EAAmC;AACjC,qBAAO,KAAP,GAAe,WAAW,aAA1B;AACD;AACD,gBAAI,MAAJ,CAAW,WAAW,UAAtB,EAAkC,MAAlC,CAAyC,MAAzC,EAAiD;AAC/C,0BAAY,WAAW,UADwB;AAE/C,6BAAe,WAAW,aAFqB;AAG/C,yBAAW,MAHoC;AAI/C,yBAAW,UAAU;AAJ0B,aAAjD;AAXG;AAAA;;AAAA;AAAA;AAAA;;AAmBH,oBAAQ,KAAR;AACA,gBAAI,MAAJ,CAAW,GAAX,EAAgB,IAAhB,CAAqB,EAArB;;AApBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;kBAAe,Q;;;;;QA9CN,M,GAAA,M;QAKA,M,GAAA,M;QAKA,I,GAAA,I;QA+BA,O,GAAA,O;;AA7ChB;;AACA;;;;;;IACO,S,oBAAA,S;AAEA,SAAS,MAAT,CAAiB,GAAjB,EAAsB,GAAtB,EAA2B;AAChC,MAAI,OAAJ;AACA,yBAAQ,GAAR,EAAa,uBAAb,EAAsC,EAAC,gBAAgB,KAAjB,EAAtC,EAA+D,OAA/D,CAAuE,mBAAI,GAAJ,CAAvE;AACD;;AAEM,SAAS,MAAT,CAAiB,GAAjB,EAAsB,GAAtB,EAA2B;AAChC,MAAI,OAAJ;AACA,yBAAQ,GAAR,EAAa,uBAAb,EAAsC,EAAC,gBAAgB,KAAjB,EAAtC,EAA+D,OAA/D,CAAuE,mBAAI,GAAJ,CAAvE;AACD;;AAEM,SAAS,IAAT,CAAe,GAAf,EAAoB,GAApB,EAAyB;AAC9B,MAAI,OAAJ;AACA,yBAAQ,GAAR,EAAa,qBAAb,EAAoC;AAClC,oBAAgB,KADkB;AAElC,YAAQ;AACN,sBAAgB,IAAI,KAAJ,CAAU;AADpB;AAF0B,GAApC,EAKG,OALH,CAKW,mBAAI,GAAJ,CALX;AAMD;;AAuBM,SAAS,OAAT,CAAkB,GAAlB,EAAuB,GAAvB,EAA4B;AACjC,MAAI,OAAJ;AACA,MAAI,IAAJ,CAAS,EAAC,MAAM,SAAP,EAAT;AACD","file":"facebook.controller.js","sourcesContent":["import { getData, fwd } from '../../app/api/api-front'\nimport config from '../../../config'\nconst {apiClient} =config\n\nexport function signin (req, res) {\n  res.noCache()\n  getData(req, '/auth/facebook/signin', {followRedirect: false}).nodeify(fwd(res))\n}\n\nexport function signup (req, res) {\n  res.noCache()\n  getData(req, '/auth/facebook/signup', {followRedirect: false}).nodeify(fwd(res))\n}\n\nexport function link (req, res) {\n  res.noCache()\n  getData(req, '/auth/facebook/link', {\n    followRedirect: false,\n    header: {\n      'Access-Token': req.query.access_token\n    }\n  }).nodeify(fwd(res))\n}\n\nexport async function unlink (req, res) {\n  res.noCache()\n  try {\n    const facebookCompleteFlow = await getData(req, '/auth/facebook/unlink', {\n      followRedirect: false,\n      header: {\n        'Access-Token': req.query.access_token\n      }\n    })\n    var fbResponse = facebookCompleteFlow[0]\n      , fbBody = facebookCompleteFlow[1]\n\n    const layout = 'layouts/oauth-social-unlink'\n    res.status(fbResponse.statusCode).render(layout, fbBody)\n  }\n  catch (err) {\n    console.error(err)\n    res.status(500).send('')\n  }\n}\n\nexport function failure (req, res) {\n  res.noCache()\n  res.json({type: 'failure'})\n}\n\nexport async function callback (req, res) {\n  res.noCache()\n  try {\n    const facebookCompleteFlow = await getData(req, '/auth/facebook/callback', {followRedirect: false})\n    var fbResponse = facebookCompleteFlow[0]\n      , fbBody = facebookCompleteFlow[1]\n\n    const layout = 'layouts/oauth-success'\n    if (fbResponse.statusCode !== 200) {\n      fbBody.error = fbResponse.statusMessage\n    }\n    res.status(fbResponse.statusCode).render(layout, {\n      statusCode: fbResponse.statusCode,\n      statusMessage: fbResponse.statusMessage,\n      tokenData: fbBody,\n      storageId: apiClient.token\n    })\n  }\n  catch (err) {\n    console.error(err)\n    res.status(500).send('')\n  }\n}\n"]}